#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import os.path as osp
from copy import deepcopy

import torch
import torch.nn as nn
from torch.nn import functional as F
from torch.utils.data import DataLoader
import pytorch_lightning as pl
import hydra
from omegaconf import OmegaConf

from bvpr import *
from bvpr.util import process_config
from bvpr.models import LSTMCNNBaseline
from bvpr.data.refexp import ReferDataset as Dataset


CONFIG_DIR = osp.abspath(osp.join(__file__, "../..", "config"))


@hydra.main(config_path=CONFIG_DIR, config_name="train")
def main(config):
    config = OmegaConf.to_container(config)
    config = pl.utilities.parsing.AttributeDict(config)
    pl.seed_everything(config["seed"])
    print(config)
    dataset = Dataset(**config["dataset"])
    config["model"] = process_config(config["model"], dataset)
    model = LSTMCNNBaseline(config["model"])
    import ipdb; ipdb.set_trace()


if __name__ == "__main__":
    main()
